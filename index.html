<html>
    <head>
        <title>Muddy Branch Greenway Trail</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.5.0/dist/maplibre-gl.css' crossorigin="anonymous"/>
        <script src="https://unpkg.com/maplibre-gl@5.5.0/dist/maplibre-gl.js" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/pmtiles@4.3.0/dist/pmtiles.js"></script>
        <style>
            body { margin: 0; padding: 0; }
            html, body, #map { height: 100%; }
        </style>
    </head>
    <body>
        <style>
            #map canvas {
                cursor: grab;
            }
            
            .maplibregl-popup h3.custom-popup {
                font-size: 16px;
                color: green;
            }
            .popup_table {
                font-size: 14px;
            }
        </style>
        <div id="map"></div>
        <script type="text/javascript">

            // add the PMTiles plugin to the maplibregl global.
            let pm = new pmtiles.Protocol();
            maplibregl.addProtocol("pmtiles",pm.tile);

            let PMTILES_URL = "assets/Muddy_Branch_Greenway_Trail_Map/muddy_branch_area.pmtiles";
            const p = new pmtiles.PMTiles(PMTILES_URL);
            pm.add(p);

            p.getHeader().then(h => {
                const map = new maplibregl.Map({
                    container: 'map',
                    zoom: 11.7,
                    center: [h.centerLon, h.centerLat],
                    maxBounds: h.bounds,
                    style: "./assets/Muddy_Branch_Greenway_Trail_Map/style.json",
                    attributionControl: false,
                });
                map.setMaxZoom(18);
                map.setMinZoom(10);

                map.addControl(new maplibregl.AttributionControl({compact: true}));
                map.addControl(new maplibregl.NavigationControl(), 'top-right');

                // When a click event occurs on an access point icon, open a popup at the
                // location of the feature, with description HTML from its properties.
                map.on('click', ['muddy_branch_access','muddy_branch_parking','muddy_branch_landmark'], (e) => {
                    const coordinates = e.lngLat
                    const properties = e.features[0].properties;

                    let popup_info = '';
                    let table_content = properties;
                    // select from this explicit list of properties:
                    const {surface, fee, changing_table, portable, unisex} = properties;
                    if (properties.amenity === "parking") {
                        popup_info = popup_info ? popup_info : "Parking Lot";
                        // Show these properties for parking lots:
                        table_content = {surface, fee};
                        popup_info = properties.name;
                    } else if (properties.amenity === "toilets") {
                        popup_info = popup_info ? popup_info : "Restroom";
                        // Show these properties for restrooms:
                        table_content = {changing_table, portable, unisex}
                    };

                    popup_info = "<h3 class='custom-popup'>" + popup_info + "</h3>";
                    popup_info += "<table id='popup' class='popup_table'>";
                    for (let x in table_content) {
                        popup_info += "<tr><td>" + x + "</td><td>" + properties[x] + "</td></tr>";
                    }
                    popup_info +="</table>";
                
                    new maplibregl.Popup()
                        .setLngLat(coordinates)
                        .setHTML(popup_info)
                        .addTo(map);
                    });

                // Change the cursor to a pointer when the mouse is over the places layer.
                map.on('mouseenter', 'muddy_branch_access', () => {
                    map.getCanvas().style.cursor = 'pointer';
                });

                // Change it back to a pointer when it leaves.
                map.on('mouseleave', 'muddy_branch_access', () => {
                    map.getCanvas().style.cursor = '';
                });
            });
        </script>
    </body>
</html>